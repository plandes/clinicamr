# @meta {desc: 'application object config', date: '2024-01-11'}


## Overrides
#
# keep spaCy entity copy, but add MIMIC mask tokenization (comment out if
# non-MIMIC source)
amr_base_doc_parser:
  components: 'instance: list: mimic_component, mimic_tokenizer_component'

# use the AMR base doc parser since it does not embed entities so token indexes
# are not perturbed by multi-word named entities
mednlp_combine_biomed_doc_parser:
  target_parser: 'instance: amr_base_doc_parser'

# use scispacy NER model
mednlp_biomed_parser:
  model_name: en_ner_bionlp13cg_md

# use scispacy biomed and MedCAT entitiy linking; see camr_paragraph_factory,
# camr_doc_base_parser
mednlp_default:
  doc_parser: mednlp_combine_biomed_doc_parser

# use the medical parser when creating AmrFeatureDocument instances
amr_anon_doc_parser:
  delegate: 'instance: ${mednlp_default:doc_parser}'

# use the annotation (already default); see camr_paragraph_factory,
# camr_doc_base_parser
amr_default:
  doc_parser: amr_anon_doc_parser

# medical section segmentation
mimicsid_section_predictor:
  section_filter_type: >-
    eval({'import': ['zensols.mimicsid as m']}):
      m.SectionFilterType.keep_non_empty


## Section paragraph
#
camr_token_cui_doc_decorator:
  class_name: zensols.clinicamr.decorator.ClinicTokenAnnotationFeatureDocumentDecorator
  role: :cui
  feature_id: cui_
  use_sent_index: false

amr_token_ent_doc_decorator:
  use_sent_index: false

camr_paragraph_stash:
  class_name: zensols.db.sqlite.SqliteDbStash
  path: 'path: ${mimic_default:shared_data_dir}/sec-para/${amr_default:parse_model}.sqlite3'

camr_paragraph_factory:
  class_name: zensols.clinicamr.parafac.ClinicAmrParagraphFactory
  delegate: 'instance: mimic_chunker_paragraph_factory'
  amr_annotator: 'instance: ${amr_default:doc_parser}'
  stash: 'instance: camr_paragraph_stash'
  condition:
    if: 'eval: ${clinicamr_default:map_cuis}'
    then:
      document_decorators: 'instance: tuple: camr_token_cui_doc_decorator, amr_token_ent_doc_decorator'
    else:
      document_decorators: []


## Application objects
#
# spring AMR (THYME) parser
camr_parser_spring:
  class_name: zensols.clinicamr.spring.SpringAmrParser
  client: 'instance: amr_spring_client'

# plot graphs for pysician evaluation
amr_plotter:
  class_name: zensols.clinicamr.Plotter
  corpus: 'instance: mimic_corpus'
  anon_resource: 'instance: mimicsid_anon_resource'
  plot_path: 'path: ${clinicamr_default:amr_plot_path}'
